<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Python拼接图片 | Return&#39;s Blog </title>
  <meta name="author" content="Return">
  
  <meta name="description" content="专注于互联网开发技术，注重网络安全技术，注重网络攻防技术，注重渗透测试技术，backtrack5渗透测试平台研究，软件开发，网页设计，网页制作，网站建设">
  
  
  <meta property="og:title" content="Python拼接图片"/>
  <meta property="og:site_name" content="Return&#39;s Blog "/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://www.creturn.com/atom.xml" title="Return&#39;s Blog " type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">Return&#39;s Blog </a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
    </ul>
</nav>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/原创作品/">原创作品</a><small>30</small></li>
  
    <li><a href="/categories/原创作品/技术文章/">技术文章</a><small>23</small></li>
  
    <li><a href="/categories/技术文章/">技术文章</a><small>7</small></li>
  
    <li><a href="/categories/原创作品/技术文章/最新漏洞/">最新漏洞</a><small>3</small></li>
  
    <li><a href="/categories/技术文章/最新漏洞/">最新漏洞</a><small>2</small></li>
  
    <li><a href="/categories/最新漏洞/">最新漏洞</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 10.00px;">Android</a><a href="/tags/Backtrack5/" style="font-size: 10.00px;">Backtrack5</a><a href="/tags/Metasploit/" style="font-size: 10.00px;">Metasploit</a><a href="/tags/Mysql/" style="font-size: 10.00px;">Mysql</a><a href="/tags/Nginx解析漏洞/" style="font-size: 10.00px;">Nginx解析漏洞</a><a href="/tags/Return/" style="font-size: 10.00px;">Return</a><a href="/tags/ThinkPHP远程/" style="font-size: 10.00px;">ThinkPHP远程</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/android/" style="font-size: 13.33px;">android</a><a href="/tags/apache/" style="font-size: 10.00px;">apache</a><a href="/tags/armitage/" style="font-size: 10.00px;">armitage</a><a href="/tags/arp欺骗/" style="font-size: 10.00px;">arp欺骗</a><a href="/tags/cain/" style="font-size: 10.00px;">cain</a><a href="/tags/dedecms漏洞/" style="font-size: 10.00px;">dedecms漏洞</a><a href="/tags/easyui/" style="font-size: 10.00px;">easyui</a><a href="/tags/eclipse/" style="font-size: 10.00px;">eclipse</a><a href="/tags/java/" style="font-size: 10.00px;">java</a><a href="/tags/linux arp欺骗/" style="font-size: 10.00px;">linux arp欺骗</a><a href="/tags/os x/" style="font-size: 10.00px;">os x</a><a href="/tags/php/" style="font-size: 13.33px;">php</a><a href="/tags/phpcmsv9漏洞/" style="font-size: 16.67px;">phpcmsv9漏洞</a><a href="/tags/phpcsm2008漏洞/" style="font-size: 10.00px;">phpcsm2008漏洞</a><a href="/tags/python/" style="font-size: 13.33px;">python</a><a href="/tags/thinkPHP漏洞/" style="font-size: 10.00px;">thinkPHP漏洞</a><a href="/tags/ubuntu/" style="font-size: 10.00px;">ubuntu</a><a href="/tags/web wifi认证/" style="font-size: 10.00px;">web wifi认证</a><a href="/tags/webshell/" style="font-size: 20.00px;">webshell</a><a href="/tags/window密码/" style="font-size: 10.00px;">window密码</a><a href="/tags/wordpress漏洞/" style="font-size: 13.33px;">wordpress漏洞</a><a href="/tags/workflow/" style="font-size: 10.00px;">workflow</a><a href="/tags/xUtils/" style="font-size: 10.00px;">xUtils</a><a href="/tags/互联网技术/" style="font-size: 10.00px;">互联网技术</a><a href="/tags/任意密码登录/" style="font-size: 10.00px;">任意密码登录</a><a href="/tags/任意读取文件漏洞/" style="font-size: 10.00px;">任意读取文件漏洞</a><a href="/tags/入侵/" style="font-size: 10.00px;">入侵</a><a href="/tags/后门/" style="font-size: 20.00px;">后门</a><a href="/tags/嗅探/" style="font-size: 10.00px;">嗅探</a><a href="/tags/图马/" style="font-size: 10.00px;">图马</a><a href="/tags/打飞机/" style="font-size: 10.00px;">打飞机</a><a href="/tags/注入漏洞/" style="font-size: 10.00px;">注入漏洞</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 Return
  
</div>


<div style="position:relative; bottom: 23px">
  <script src="http://s95.cnzz.com/stat.php?id=4287542&web_id=4287542&show=pic1" language="JavaScript">
  </script>
</div>


</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">Return&#39;s Blog </a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title">Python拼接图片</h1>
  

      <time datetime="2013-03-12T05:42:13.000Z"><a href="/html/2013-03-12-python拼接图片.html">3月 12 2013</a></time>
      
  </header>
    <div class="entry">
      
        <p>貌似这是13年第一次写文章了。好吧，去年主要写一些安全方面的文章，今年就把技术文章也加进来，已做笔记（其实天天用evenote）。</p>
<p>人常说，不偷懒的程序员不是好程序员。今天有个任务比较麻烦，当然这个还不是我自己的任务。其实是美工的，不过一个团队，能帮</p>
<p>点尽量帮点忙。神马任务呢？就是游戏的图场景已经被地图编辑器分割成300×300像素的小图。然后部门经理要美工吧图都拼成大图以便</p>
<p>修改方便…100多场景，每个场景里面至少150张小图，任你美工技术多牛叉，我想没一个星期是弄不来的。</p>
<p>So 就帮妹子一把~。~</p>
<a id="more"></a>

<p>废话不多说的直接开始，先看看目录结构和图片的结构：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-4.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-4.png" alt="QQ20131106-4"></a></p>
<p>其实分析小图，和对比里面的small我发现图片命名规则是pic后面一个数字是分割的列数，下划线后面的则是坐在行数</p>
<p>并且每张小图都是300×300</p>
<p>这样的话我自己的处理思路是这样的：</p>
<p>首先，分析文件提取出行数和列数，然后计算原图的大小。</p>
<p>然后不管用哪种语言，只要支持图片处理的就基本可以做。新建一个原图大小的画布，或者空的图片。</p>
<p>最后根据行列位置填充相应的小图就拼接出来原图了。自己虽然做php的，但更偏爱python来处理小事情。so…上码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="code"><pre>&lt;pre title=&quot;&quot;&gt;<span class="comment">#!/usr/bin/env python</span>
<span class="comment">#coding: utf-8</span>

<span class="keyword">import</span> PIL.Image <span class="keyword">as</span> Image
<span class="keyword">import</span> os
<span class="class"><span class="keyword">class</span> <span class="title">ImageUtil</span>:</span>
 <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,path)</span>:</span>
 <span class="comment"># 小图宽度</span>
 self.sizeX = <span class="number">300</span>
 <span class="comment"># 小图高度</span>
 self.sizeY = <span class="number">300</span>
 <span class="comment"># 高度有多少行</span>
 self.sizeH = <span class="number">0</span>
 <span class="comment"># 高度有多少列</span>
 self.sizeW = <span class="number">0</span>
 <span class="comment">#拼接图片存放位置</span>
 self.imageDirPath = path
 <span class="comment"># 拼接后图片的总宽度</span>
 self.toImageWidth = <span class="number">0</span>
 <span class="comment"># 拼接后图片的总高度</span>
 self.toImageHeight = <span class="number">0</span>
 <span class="comment"># 拼接图片后存放的位置</span>
 self.toImageSavePath = <span class="string">''</span>
 <span class="comment"># 获取需要转换成大图的图片大小</span>
 <span class="function"><span class="keyword">def</span> <span class="title">getToImageSize</span><span class="params">(self)</span>:</span>
 tmpX = <span class="number">0</span>
 tmpY = <span class="number">0</span>
 imgList = os.listdir(self.imageDirPath)
 tmpList = []
 <span class="comment"># 过滤出目标文件</span>
 <span class="keyword">for</span> img <span class="keyword">in</span> imgList:
 <span class="keyword">if</span> img.find(<span class="string">'pic'</span>) == <span class="number">0</span>:
 <span class="comment"># 分割文件名</span>
 tmpList.append(img.replace(<span class="string">'pic'</span>,<span class="string">''</span>).replace(<span class="string">'.jpg'</span>,<span class="string">''</span>).split(<span class="string">'_'</span>))
 <span class="comment"># 计算行和列</span>
 <span class="keyword">for</span> size <span class="keyword">in</span> tmpList:
 <span class="keyword">if</span> int(size[<span class="number">1</span>]) &gt; tmpY:
 tmpY = int(size[<span class="number">1</span>])
 <span class="keyword">if</span> int(size[<span class="number">0</span>]) &gt; tmpX:
 tmpX = int(size[<span class="number">0</span>])
 self.sizeH = tmpY
 self.sizeW = tmpX
 <span class="comment"># 计算目标大图长宽</span>
 self.toImageWidth = self.sizeX * (tmpX - <span class="number">1</span>)
 self.toImageHeight = self.sizeY * (tmpY -<span class="number">1</span>)
 <span class="keyword">return</span> self
 <span class="comment"># 开始转换</span>
 <span class="function"><span class="keyword">def</span> <span class="title">convert</span><span class="params">(self)</span>:</span>
 toImage = Image.new(<span class="string">'RGBA'</span>,(self.toImageWidth,self.toImageHeight))

<span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">0</span>,self.sizeH - <span class="number">1</span>):
 <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">0</span>,self.sizeW - <span class="number">1</span>):
 fname = <span class="string">'pic%s_%s.jpg'</span>%(x,y)
 fname = self.imageDirPath + <span class="string">'/'</span> + fname
 fromImage = Image.open(fname)
 toImage.paste(fromImage,(x*self.sizeX,y*self.sizeY))
 <span class="comment"># print fromImage.size</span>

toImage.save(<span class="string">'./save_1001.jpg'</span>)

<span class="keyword">pass</span>

<span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span>
 path = <span class="string">'./front_1001'</span>
 imgUtl = ImageUtil(path)
 imgUtl.getToImageSize().convert()

<span class="keyword">pass</span>

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
 main()&lt;/pre&gt;
</pre></td></tr></table></figure>

<p>运行后会根据指定目录分析文件后，最后拼接城一个大图。</p>
<p>合成后的图片大小：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-5.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-5.png" alt="QQ20131106-5"></a></p>
<p>嘿嘿，还是python好用</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="null"><strong>creturn</strong></a> - 3月 12 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://creturn.com"><strong>Return&#39;s Blog </strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
	 
     		  
  
  <div class="categories">
    <a href="/categories/原创作品/">原创作品</a>, <a href="/categories/原创作品/技术文章/">技术文章</a>
  </div>

       		
  
  <div class="tags">
    <a href="/tags/python/">python</a>
  </div>

     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
</div>


  </div>
</body>
</html>