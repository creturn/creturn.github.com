<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Radiowar 之OsmocomBB SMS Sniffer | Return&#39;s Blog </title>
  <meta name="author" content="Return">
  
  <meta name="description" content="专注于互联网开发技术，注重网络安全技术，注重网络攻防技术，注重渗透测试技术，backtrack5渗透测试平台研究，软件开发，网页设计，网页制作，网站建设">
  
  
  <meta property="og:title" content="Radiowar 之OsmocomBB SMS Sniffer"/>
  <meta property="og:site_name" content="Return&#39;s Blog "/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://www.creturn.com/atom.xml" title="Return&#39;s Blog " type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">Return&#39;s Blog </a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
    </ul>
</nav>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/原创作品/">原创作品</a><small>30</small></li>
  
    <li><a href="/categories/原创作品/技术文章/">技术文章</a><small>23</small></li>
  
    <li><a href="/categories/技术文章/">技术文章</a><small>7</small></li>
  
    <li><a href="/categories/原创作品/技术文章/最新漏洞/">最新漏洞</a><small>3</small></li>
  
    <li><a href="/categories/技术文章/最新漏洞/">最新漏洞</a><small>2</small></li>
  
    <li><a href="/categories/最新漏洞/">最新漏洞</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 10.00px;">Android</a><a href="/tags/Backtrack5/" style="font-size: 10.00px;">Backtrack5</a><a href="/tags/Metasploit/" style="font-size: 10.00px;">Metasploit</a><a href="/tags/Mysql/" style="font-size: 10.00px;">Mysql</a><a href="/tags/Nginx解析漏洞/" style="font-size: 10.00px;">Nginx解析漏洞</a><a href="/tags/Return/" style="font-size: 10.00px;">Return</a><a href="/tags/ThinkPHP远程/" style="font-size: 10.00px;">ThinkPHP远程</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/android/" style="font-size: 13.33px;">android</a><a href="/tags/apache/" style="font-size: 10.00px;">apache</a><a href="/tags/armitage/" style="font-size: 10.00px;">armitage</a><a href="/tags/arp欺骗/" style="font-size: 10.00px;">arp欺骗</a><a href="/tags/cain/" style="font-size: 10.00px;">cain</a><a href="/tags/dedecms漏洞/" style="font-size: 10.00px;">dedecms漏洞</a><a href="/tags/easyui/" style="font-size: 10.00px;">easyui</a><a href="/tags/eclipse/" style="font-size: 10.00px;">eclipse</a><a href="/tags/java/" style="font-size: 10.00px;">java</a><a href="/tags/linux arp欺骗/" style="font-size: 10.00px;">linux arp欺骗</a><a href="/tags/os x/" style="font-size: 10.00px;">os x</a><a href="/tags/php/" style="font-size: 13.33px;">php</a><a href="/tags/phpcmsv9漏洞/" style="font-size: 16.67px;">phpcmsv9漏洞</a><a href="/tags/phpcsm2008漏洞/" style="font-size: 10.00px;">phpcsm2008漏洞</a><a href="/tags/python/" style="font-size: 13.33px;">python</a><a href="/tags/thinkPHP漏洞/" style="font-size: 10.00px;">thinkPHP漏洞</a><a href="/tags/ubuntu/" style="font-size: 10.00px;">ubuntu</a><a href="/tags/web wifi认证/" style="font-size: 10.00px;">web wifi认证</a><a href="/tags/webshell/" style="font-size: 20.00px;">webshell</a><a href="/tags/window密码/" style="font-size: 10.00px;">window密码</a><a href="/tags/wordpress漏洞/" style="font-size: 13.33px;">wordpress漏洞</a><a href="/tags/workflow/" style="font-size: 10.00px;">workflow</a><a href="/tags/xUtils/" style="font-size: 10.00px;">xUtils</a><a href="/tags/互联网技术/" style="font-size: 10.00px;">互联网技术</a><a href="/tags/任意密码登录/" style="font-size: 10.00px;">任意密码登录</a><a href="/tags/任意读取文件漏洞/" style="font-size: 10.00px;">任意读取文件漏洞</a><a href="/tags/入侵/" style="font-size: 10.00px;">入侵</a><a href="/tags/后门/" style="font-size: 20.00px;">后门</a><a href="/tags/嗅探/" style="font-size: 10.00px;">嗅探</a><a href="/tags/图马/" style="font-size: 10.00px;">图马</a><a href="/tags/打飞机/" style="font-size: 10.00px;">打飞机</a><a href="/tags/注入漏洞/" style="font-size: 10.00px;">注入漏洞</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 Return
  
</div>


<div style="position:relative; bottom: 23px">
  <script src="http://s95.cnzz.com/stat.php?id=4287542&web_id=4287542&show=pic1" language="JavaScript">
  </script>
</div>


</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">Return&#39;s Blog </a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title">Radiowar 之OsmocomBB SMS Sniffer</h1>
  

      <time datetime="2013-11-06T12:34:49.000Z"><a href="/html/2013-11-06-radiowar-之osmocombb-sms-sniffer.html">11月 6 2013</a></time>
      
  </header>
    <div class="entry">
      
        <p>好久没写东西了，前几天看到Radiowar这个词的时候感觉有点意思，</p>
<p>可能是因为之前写过War Driving 的文章对War很敏感吧.</p>
<p>Radiowar指的是无线安全攻击，不过很多人听到无线攻击就和无线网络破解划等号了。</p>
<p>其实Radiowar 包含所有无线电子设备如：2.4GHz网络、RFID、NFC等等.</p>
<p>很多人现在都在玩Proxmark3 奈何成本过大，做个试验最少也得千把来块，自己对这个也仅仅是感兴趣，</p>
<p>所以就从一些简单且Cheap的设备玩起，刚好最近看到有几个人发了GSM网络嗅探的文章，</p>
<p>自己就弄些设备来玩，成本较低，一套设备下来100左右。</p>
<p>设备清单：</p>
<ol>
<li>摩托罗拉 C118 (25块)</li>
<li>FT232RL USB TO TTL (30元)</li>
<li>摩托罗拉 Motorola C118专用数据连接线 (10块)</li>
<li>MiniUSB 链接线(10元，这个大家手里应该都有)</li>
</ol>
<p>如下图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-7.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-7.png" alt="QQ20131106-7"></a>
<a id="more"></a></p>
<p>淘宝购买地址就放在文章结尾吧.</p>
<p>外围设备是上面那些，现在还需要一台PC以及装有Linux操作系统的虚拟机，当然PC上面直接装的linux更好</p>
<p>还有一个主角：OsmocomBB</p>
<p>这里稍微介绍下OsmocomBB，OsmocomBB是GSM协议栈(Protocols stack)的开源实现，全称是Open source mobile communication Baseband.</p>
<p>目的是要实现手机端从物理层(layer1)到layer3的三层实现。</p>
<p>但是目前来看，真正的物理层(physical layer)并没有真正的开源实现，暂时也没看到实施计划。只有物理层控制。</p>
<p>因为真正的物理层是运行在baseband processor的DSP core上,涉及到许多信号处理算法的实现，而且还要牵扯很多硬件RF的东西。</p>
<p>额好吧，上面这段OsmocomBB介绍文字来自百度~~</p>
<p>我自己的实验环境为：</p>
<p>os x 10.9  + VirtualBox + Ubuntu 12.04 (32位)</p>
<p>操作系统各个平台都无所谓，我想大多数都用虚拟机来测的，所以建议使用Ubuntu 12.04 至少按照我这里介绍的做下来应该不会出错。</p>
<p>虚拟机里面如何安装Ubuntu 12.04我这里几不操作了，网上教程一大堆。</p>
<p>首先我们安装交叉编译环境：</p>
<p>1. 用户目录下建立source/arm</p>
<p>2. 进入arm目录再创建三个目录  build、 install 、src</p>
<p>3. 进入src目录分别下载这三个文件包：</p>
<p><a href="http://ftp.gnu.org/gnu/gcc/gcc-4.5.2/gcc-4.5.2.tar.bz2" target="_blank">http://ftp.gnu.org/gnu/gcc/gcc-4.5.2/gcc-4.5.2.tar.bz2</a></p>
<p><a href="http://ftp.gnu.org/gnu/binutils/binutils-2.21.1a.tar.bz2" target="_blank">http://ftp.gnu.org/gnu/binutils/binutils-2.21.1a.tar.bz2</a></p>
<p>ftp://sources.redhat.com/pub/newlib/newlib-1.19.0.tar.gz</p>
<p>4. 下载 gnu-arm-build.2.sh 文件到arm目录 <a href="http://bb.osmocom.org/trac/raw-attachment/wiki/GnuArmToolchain/gnu-arm-build.2.sh" target="_blank">http://bb.osmocom.org/trac/raw-attachment/wiki/GnuArmToolchain/gnu-arm-build.2.sh</a></p>
<p>目录结构如图所示：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.05.58-PM.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.05.58-PM.png" alt="屏幕快照 2013-11-06 06.05.58 PM"></a></p>
<p>编译前需要安装相应的库文件执行如下命令：</p>
<p>[shell]
sudo apt-get install build-essential libgmp3-dev libmpfr-dev libx11-6 libx11-dev texinfo flex bison libncurses5 libncurses5-dbg libncurses5-dev libncursesw5 libncursesw5-dbg libncursesw5-dev zlibc zlib1g-dev libmpfr4 libmpc-dev
[/shell]</p>
<p>安装完</p>
<p>在arm根目录执行如下命令:</p>
<p>[shell]
chmod +x  gnu-arm-build.2.sh
./ gnu-arm-build.2.sh
[/shell]</p>
<p>解释下这两条命令的意思，chmod +x 是给与  gnu-arm-build.2.sh 可执行权限 ， ./ gnu-arm-build.2.sh 是执行它</p>
<p>执行 gnu-arm-build.2.sh后会提示你是否继续，ctrl+c 则取消，直接回车。如下图所示：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.16.42-PM.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.16.42-PM.png" alt="屏幕快照 2013-11-06 06.16.42 PM"></a></p>
<p>完成后会看到arm/install目录结构如图所示：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.31.12-PM.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.31.12-PM.png" alt="屏幕快照 2013-11-06 06.31.12 PM"></a></p>
<p>我们需要将 arm/install/bin目录加入环境变量中，注意这里最好直接填写绝对路径</p>
<p>获取绝对路径命令，在arm/install/bin目录下执行pwd命令。如下图</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.32.52-PM.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.32.52-PM.png" alt="屏幕快照 2013-11-06 06.32.52 PM"></a></p>
<p>加入环境变量的方法用vi打开 ~/.bashrc 在最后一样加入  export PATH=$PATH:/home/creturn/source/arm/install/bin</p>
<p>注意$PATH:冒号后面接的是你自己的绝对路径，有的同学不会用vi的话我就把具体命令写出来</p>
<p>[shell]
cd 回车  #切换到主目录
vi ./.bashrc  #打开文件
shift+g  #按shift和g 跳转到最后一样
o       #输入小写字母o换行并进入插入模式，然后把上面需要加入的代码加入进去
esc    # 按esc键进入命令模式
:wq  #按冒号然后输入回车编辑完成
[/shell]</p>
<p>为照顾linux新手对写点东西，汗~~</p>
<p>重新打开终端或者直接执行source ~/.bashrc 让环境变量生效</p>
<p>在终端中输入arm然后按tab键，如果出现 arm-开头的如下图所示就说明编译环境搞定了：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.43.44-PM.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/屏幕快照-2013-11-06-06.43.44-PM.png" alt="屏幕快照 2013-11-06 06.43.44 PM"></a></p>
<p>好了累了半死才把编译环境搞定，接下来下载 OsmocomBB 源码</p>
<p>在source目录下执行下面两条命令：</p>
<p>[shell]
git clone git://git.osmocom.org/osmocom-bb.git
git clone git://git.osmocom.org/libosmocore.git
[/shell]</p>
<p>先编译osmocom核心库文件,进入libosmocore 执行如下命令：</p>
<p>[shell]
autoreconf -i
./configure
make
sudo make install
[/shell]</p>
<p>然后进入osmocom/src下目录</p>
<p>git checkout --track origin/luca/gsmmap 切换到这个分支</p>
<p>执行make命令</p>
<p>如果不出意外你所需软件环境和固件都编译好了。Ubuntu12.04 默认能够识别FT232R所以不用装驱动。</p>
<p>接下来链接硬件， FT232RL USB TO TTL 和 摩托的数据线链接注意上面对应的标识接入GND、RX、TX 所以不用担心接错，我也第一次摸板子。</p>
<p>链接完成后需要注意，如果链接正常下载板上面的蓝色的灯和红色的灯都要亮，不然肯定是接触不良，</p>
<p>我之前由于接触不良导致固件写入一半就会停止，或者包其他错误。所以这里需要特别注意。</p>
<p>插入硬件后在虚拟机菜单中把接入下载板子的usb接口分配给虚拟机如图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-9.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-9.png" alt="QQ20131106-9"></a></p>
<p>在终端中输入lsusb 如果驱动正常就能看到usb-serial</p>
<p>看下分配前和分配后的区别如下图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-10.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-10.png" alt="QQ20131106-10"></a></p>
<p>接下来我们写入固件到手机中，这里需要说明的一点，很多人说是刷入固件，导致很多人误认为是刷机，其实只是把</p>
<p>固件加载到手机raw中执行而已，所以也不要担心输入固件后手机就不能用了。</p>
<p>切换到 osmocom-bb/src/host/osmocon/目录 执行如下命令：</p>
<p>[shell]
/osmocon -m c123 -p /dev/ttyUSB0  ../../target/firmware/board/compal_e88/layer1.compalram.bin
[/shell]</p>
<p>这里同样需要说明下有的 -m 后面接的是 c123xor 区别是是否检测数据总和</p>
<p>注意上面命令需要在关机下执行，然后短按开机键，注意不要长按不然就开机了</p>
<p>如果不出意外就能看到如下图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-11.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-11.png" alt="QQ20131106-11"></a></p>
<p>这里需要提醒下，由于买的手机都是二手的，所以接口处有可能会有松动，所以如果看到数据写入被取消就多试几次</p>
<p>调整下接口看看是否有松动，我机会每次都要试4-5次才能正常写入固件，看到staring up 基本就成功了，同事可以看到</p>
<p>手机上面也显示了 Layer 1 osmocom-bb 字样</p>
<p>[<img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-12.png" alt="QQ20131106-12"></p>
<p>](<a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-12.png)接下来在" target="_blank">http://www.creturn.com/asset/uploads/2013/11/QQ20131106-12.png)接下来在</a> /osmocom-bb/src/host/layer23/src/misc/ 目录执行  ./cell_log</p>
<p>输出日志信息，在里面可以看到基站信息</p>
<p>找到类似信息</p>
<p>cell_log.c:248 Cell: ARFCN=117 PWR=-62dB MCC=460 MNC=01</p>
<p>如下图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-13.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-13.png" alt="QQ20131106-13"></a></p>
<p>记住ARFCN后面的编号</p>
<p>然后在同样目录下输入下面命令把数据流导入本地4729端口</p>
<p>[shell]</p>
<p>./ccch_scan -i 127.0.0.1 -a 117 # 注意这里的117就是上面的ARFCN后面的编号</p>
<p>[/shell]</p>
<p>如下图：</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-14.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-14.png" alt="QQ20131106-14"></a></p>
<p>接下来用wireshark 抓包，输入如下命令：</p>
<p>[shell]</p>
<p>sudo wireshark -k -i lo -f &#39;port 4729&#39;</p>
<p>[/shell]</p>
<p>然后在wireshark里面过滤gsm_sms协议数据，里面就包含了短信数据</p>
<p><a href="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-15.png" target="_blank"><img src="http://www.creturn.com/asset/uploads/2013/11/QQ20131106-15.png" alt="QQ20131106-15"></a></p>
<p>&nbsp;</p>
<p>好了就到这里了，剩下的自己慢慢玩吧，做了一个视频演示：</p>
<p>&nbsp;</p>
<embed src="http://player.youku.com/player.php/sid/XNjMwNjY5OTA0/v.swf" allowFullScreen="true" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed>

<p>高清版下载地址：<a href="http://pan.baidu.com/s/1ACSOE" target="_blank"><a href="http://pan.baidu.com/s/1ACSOE">http://pan.baidu.com/s/1ACSOE</a></a></p>
<p>淘宝地址在这里就去掉了，给别人带来了“一些”麻烦， 需要买的直接在淘宝里面搜索相应的关键字就能找到。 修改日期：2013.12.1</p>
<p>手机就随便在淘宝上找一家就行</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="null"><strong>creturn</strong></a> - 11月 6 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://creturn.com"><strong>Return&#39;s Blog </strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
	 
     		  
  
  <div class="categories">
    <a href="/categories/原创作品/">原创作品</a>, <a href="/categories/原创作品/技术文章/">技术文章</a>
  </div>

       		
     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
</div>


  </div>
</body>
</html>